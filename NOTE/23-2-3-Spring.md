## 核心概念

+ 代码书写现状
  + 耦合度偏高
+ 解决方案
  + 使用对象时，在程序中不要主动使用new产生对象，转换为由外部提供对象
+ IoC(Inversion of Control)控制反转
  + 对象的创建控制权由程序转移到外部，这种思想称为控制反转

### IoC(Inversion of Control)控制反转

+ 使用对象时，由主动new产生对象转换为由**外部**提供对象，此过程中对象创建控制权由程序转移到外部，此思想称为控制反转
+ **Spring技术对IOC思想进行了实现****
  + Spring技术提供了一个容器，称为Ioc容器，用来充当Ioc思想的”外部“
  + IoC容器负责对象的创建、初始化等一系列工作，被创建或被管理的对象在IoC容器中统称为**Bean**
+ **DI（Dependency Injection）依赖注入**
  + 在容器中建立bean与bean之间的依赖关系的整个过程，称为依赖注入

![image-20230203152101809](../img/image-20230203152101809.png)

+ 目标：**充分解耦*
  + 使用IoC容器管理bean（IoC）
  + 在IoC容器内将有依赖关系的bean进行关系绑定（DI）
+ 最终效果
  + 使用对象时不仅可以直接从IoC容器中获取，并且获取到的bean已经绑定了所有的依赖关系



## Spring程序开发步骤

![image-20230203115908310](../img/image-20230203115908310.png)

1. 导入Spring开发的基本包类
2. 编写Dao接口和实现类
3. 创建Spring核心配置文件
4. 在Spring配置文件中配置UserDaoImpI
5. 使用Spring的API获得Bean实例



## Spring快速入门知识点

### IOC入门案例思路分析

1. 管理什么？（Service与Dao）
2. 如何将被管理的对象告知IoC容器？（配置）
3. 被管理的对象交给IoC容器，如何获取到IoC容器？（接口）
4. IoC容器得到后，如何从容器中获取bean？（接口方法）
5. 使用Spring导入坐标？（pom.xml）

+ IOC入门案例

  1. 导入坐标

     ![image-20230203155233756](../img/image-20230203155233756.png)

  2. 定义Spring管理的类（接口）

     ![image-20230203155323744](../img/image-20230203155323744.png)

  3. 创建Spring的配置文件，配置对应类作为Spring管理的bean【applicationContext.xml】

     ![image-20230203155445902](../img/image-20230203155445902.png)

     > bean定义时id属性在同一个上下文不能重复

  4. 初始化Ioc容器（Spring核心容器/Spring容器），通过容器获取bean

     ![image-20230203155632892](../img/image-20230203155632892.png)

### DI入门案例思路分析

1. 基于IoC管理bean 
2. Service中使用new形式创建的Dao对象是否保留?（否）
3. Service中需要的Dao对象如何进入到Service中？（提供方法）
4. Service与Dao间的关系如何描述？（配置）

### DI入门案例（XML版）

1. 删除使用new的形式创建对象的代码

   ![image-20230203161141926](../img/image-20230203161141926.png)

2. 提供依赖对象对应的setter方法

   ![image-20230203161228471](../img/image-20230203161228471.png)

3. 配置service与dao之间的关系

   ![image-20230203161343486](../img/image-20230203161343486.png)

## Bean基础配置

![image-20230203165100299](../img/image-20230203165100299.png)

### Bean别名配置

![image-20230203213306079](../../ssm/img/image-20230203213306079.png)

### Bean作用范围配置

![image-20230203213609085](../../ssm/img/image-20230203213609085.png)

#### 为什么bean默认为单例？

+ 适合交给容器进行管理的bean
  + 表现层对象
  + 业务层对象
  + 数据层对象
  + 工具对象
+ 不适合交给容器进行管理的bean
  + 封装实体的域对象



## bean实例化

### bean是如何创建的、实例化bean的三种方式

bean本质上就是对象，创建bean使用构造方法完成

+ 构造方法（常用）
+ 静态工厂（了解）
+ 实例工厂（了解）
  + FactoryBean(实用)

![image-20230203214834842](../../ssm/img/image-20230203214834842.png)

![image-20230203221633574](../../ssm/img/image-20230203221633574.png)

![image-20230203222719835](../../ssm/img/image-20230203222719835.png)

![image-20230204103135190](../../ssm/img/image-20230204103135190.png)

## Bean生命周期

+ 生命周期：从创建到消亡的完整过程
+ bean生命周期：bean从创建到销毁的整体过程
+ bean生命周期控制：在bean创建后到销毁前做一些事情

![image-20230204152531411](../../ssm/img/image-20230204152531411.png)

+ 初始化容器
  1. 创建对象（内存分配）
  2. 执行构造方法
  3. 执行属性注入（set操作）
  4. 执行bean初始化方法
+ 使用bean
  1. 执行业务操作
+ 关闭/销毁容器
  1. 执行bean销毁方法

### bean销毁时机

+ 容器关闭前触发bean的销毁

+ 关闭容器方式：

  + 手工关闭容器

    ConfigurableApplicationContext接口close()操作

  + 注册关闭钩子，在虚拟机退出前先关闭容器再退出虚拟机

    ConfigurableApplicationContext接口registerShutdownHook()操作

  ![image-20230204153315611](../../ssm/img/image-20230204153315611.png)

![image-20230204153342780](../../ssm/img/image-20230204153342780.png)

## 依赖注入方式

+ 思考：向一个类中传递数据的方式有几种？
  + 普通方法（set方法）
  + 构造方法
+ 思考：依赖注入描述了在容器中建立bean与bean之间依赖关系的过程，如果bean运行需要的是数字或字符串呢？
  + 引用类型
  + 简单类型（基本数据类型与String）

### Setter注入的两种方式

![image-20230204153959734](../../ssm/img/image-20230204153959734.png)

![image-20230204161418418](../../ssm/img/image-20230204161418418.png)

### 构造器注入的两种方式

![image-20230204164907223](../../ssm/img/image-20230204164907223.png)

+ 简单类型

![image-20230204165516990](../../ssm/img/image-20230204165516990.png)

![image-20230204165011011](../../ssm/img/image-20230204165011011.png)

### 依赖注入方式选择

![image-20230204165601809](../../ssm/img/image-20230204165601809.png)

![image-20230204170126234](../../ssm/img/image-20230204170126234.png)

+ 引用类型 ref 
+ 简单类型 value

## 依赖自动装配

+ IoC容器根据bean所依赖的资源在容器中自动查找并注入到bean中到的过程称为自动装配。
+ 自动装配方式
  + 按类型（常用）
  + 按名称
  + 按构造方法
  + 不启用自动装配

![image-20230204175153906](../../ssm/img/image-20230204175153906.png)

![image-20230204175204178](../../ssm/img/image-20230204175204178.png)

## 集合注入

## 案例：数据源对象管理

### 第三方资源配置管理

![image-20230205123143602](../../ssm/img/image-20230205123143602.png)

## 加载properties文件

![image-20230205143013087](../../ssm/img/image-20230205143013087.png)

![image-20230205145339235](../../ssm/img/image-20230205145339235.png)

## 容器

### 创建容器

![image-20230205155005133](../../ssm/img/image-20230205155005133.png)

### 获取bean

![image-20230205155025818](../../ssm/img/image-20230205155025818.png)

### 容器类层次结构

![image-20230205155805251](../../ssm/img/image-20230205155805251.png)

### BeanFactory

![image-20230205155829739](../../ssm/img/image-20230205155829739.png)

## 核心容器总结

### 容器相关

![image-20230205164921327](../../ssm/img/image-20230205164921327.png)

### bean相关

![image-20230205165005248](../../ssm/img/image-20230205165005248.png)

### 依赖注入

![image-20230205165127205](../../ssm/img/image-20230205165127205.png)

## 注解开发

### 注解开发定义bean

![image-20230205173951575](../../ssm/img/image-20230205173951575.png)

### 纯注解开发

+ Spring3.0升级了纯注解开发模式，使用java类替代配置文件，开启了Spring快速开发赛道

+ Java类代替Spring核心配置文件

![image-20230205185956341](../../ssm/img/image-20230205185956341.png)

![image-20230205190052333](../../ssm/img/image-20230205190052333.png)

![image-20230205190231969](../../ssm/img/image-20230205190231969.png)

## bean管理

### bean作用范围

![image-20230205191806763](../../ssm/img/image-20230205191806763.png)

### bean生命周期

![image-20230205191820224](../../ssm/img/image-20230205191820224.png)

## 依赖注入

### 自动装配

![image-20230205205051072](../../ssm/img/image-20230205205051072.png)

![image-20230205205130018](../../ssm/img/image-20230205205130018.png)

![image-20230205205730255](../../ssm/img/image-20230205205730255.png)

![image-20230205210301751](../../ssm/img/image-20230205210301751.png)

## 第三方bean管理

![image-20230205213433627](../../ssm/img/image-20230205213433627.png)

### 第三方bean依赖注入

![image-20230205213458269](../../ssm/img/image-20230205213458269.png)

![image-20230205213529158](../../ssm/img/image-20230205213529158.png)















